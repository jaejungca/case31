---
title: "Data Analysis for Case 31"
subtitle: "Sample Presentation"
author: "Jae Jung"
institute: "IBM 3302, Cal Poly Pomona"
date: "Dec. 2, 2024"
format: 
  revealjs:
    theme: serif
    width: 1600
    height: 900
    footer: Sample Presentation for Case 31 Project
    logo: ccidm-email.png
    transition: slide
    transition-speed: default
    incremental: false
    toc: true
    toc-depth: 1
    slide-number: true
    scrollable: true
    smaller: true
    title-slide-attributes: 
      data-background-image: Purple and White.gif
    code-fold: false
    code-overflow: wrap
    code-copy: true
    number-sections: false
    number-depth: 5
    embed-resources: true
    self-contained-math: true
    css: styles.css
editor: visual
execute: 
  echo: true
  freeze: auto
bibliography: references.bib
---

# Introduction {background-color="#a13c65"}

::: {.incremental style="font-size: 1.5em; text-align: center"}
-   Employees Federal Union (EFCU) is the credit union for a Fortune 500 firm.
-   This case illustrates:
    -   the entire research process
    -   How a presentation can be prepared with enhanced reproducibility
-   This case can be used for
    -   Introductory marketing research course (R1 - R6)
    -   Upper level marketing research course (H1 - H5)
:::

::: notes
Slide zoom: hold alt + click
:::

## Problem Definition

:::: {.fragment .fade-up}
::: {.fragment .highlight-red}
-   CU has a large amount of surplus fund.
:::
::::

:::: {.fragment .fade-up}
::: {.fragment .highlight-red}
-   It has also experienced a lower loan/share ratio than other credit unions of similar size.
:::
::::

:::: {.fragment .fade-up}
::: {.fragment .highlight-red}
-   Average earnings on its investments have declined and profit margins are squeezed
:::
::::

## Research Objectives

1.  To determine why its members are not borrowing money from the credit union.
2.  To determine what the members' attitudes were toward the overall management and operations of the credit union.

::: aside
***Notes***: The research objectives were developed by the board
:::

::: notes
My speaker notes go here Press "s" on your keyboard to create a speaker view slide that you can see on the other screen
:::

## Significance of Research

-   The findings from the research will provide critical information that the management can use to increase loan/ratio rate and increase profit margin.
-   Thus, the the research is critical in turning around the company's struggling financial status.

# Background and Research Questions/Hypotheses {background-color="#a13c65"}

## Information gathering

::: incremental
-   To address the research objectives, a research firm was hired.
-   The researchers from the consulting company interviewed the management and some customers.
-   Based on the qualitative research and the researchers' own experience, they came up with some research questions and hypotheses.
:::

## Reasons for Consumers' Use of Credit Union

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "research question" because you do not have enough evidence to state the relationship with confidence.

***R1**: Why do people join the Credit Union?*

## Using services from Other Financial Services

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "research question" because you do not have enough evidence to state the relationship with confidence.

***R2**: Why do members use other financial institutions when they need to borrow funds?*

## Attitudes and beliefs about the employee proficiency

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "research question" because you do not have enough evidence to state the relationship with confidence.

***R3**: What are the members’ attitudes and beliefs about the proficiencies of credit union employees?*

## Differences in Headquarters vs. Elswhere

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "research question" because you do not have enough evidence to state the relationship with confidence.

***R4**: Are there any perceived differences on attitude towards employee proficiencies, awareness of services, and operational effectiveness between members who live in the area of the firm’s headquarters and members who live elsewhere?*

## Awareness of Services

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "research question" because you do not have enough evidence to state the relationship with confidence.

***R5**: How well are the members aware of the services offered by the credit union?*

## CU's Operational Effectiveness

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "research question" because you do not have enough evidence to state the relationship with confidence.

***R6**: What are the members’ attitudes and beliefs about how effectively the credit union is operated?*

## Adequancy of Finacial Services

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "Hypothesis" when you have enough evidence to state the relationship with confidence.

***H1**: Members’ `awareness of the regular share accounts` will influence their opinions on the `adequacy of financial services` in meeting members’ needs.*

## CU Members' Opinion on CU's Loan Rate

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "Hypothesis" when you have enough evidence to state the relationship with confidence.

***H2**: Members will not be different in their opinion on `CU’s loan rate (Q8r)` and the degree to which they agree that CU’s loan rate is lower than competitors (Q30).*

## Impact of Current loan use and residence lcoatoin on Finacial Services Adequacy

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "Hypothesis" when you have enough evidence to state the relationship with confidence.

. . .

***H3a**: There will be interaction effect between the `current loan use` and `location of residence` on adequacy of current financial services such that in headquarter area, members who have a loan will agree, more than those who don’t have, that financial services meet the members’ needs, while in outside headquarter area, loan status doesn’t influence adequacy of financial services in meeting member needs.*

. . .

***H3b**: Test H2a controlling for the impact of attitudes toward employee proficiency.*

## Loan Status and CU Loan Rate

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "Hypothesis" when you have enough evidence to state the relationship with confidence.

. . .

***H4**: Compared with the members who have a loan, [those members who don’t have a loan]{style="color:red;"} currently with the Credit Union will feel that that CU charges them with higher rates, and that they will agree less with the statement that CU’s loan rates are lower than those offered by other institutions.*

## Factors Affecting Attitudes towards Credit Union Operational Efficiency

-   What to write on this sub-section?
    -   You can use information you learned from academic research
    -   You may use white paper available online
    -   You can use information you obtained from managers
-   Weave the information from various sources to form a logic to support the relationships among the variables in the research question.
-   You are labeling it "Hypothesis" when you have enough evidence to state the relationship with confidence.

***H5a**: Member belief about CU keeps personal `financial information confidential` will positively influence the overall attitude toward credit union’s operational efficiency.*

. . .

***H5b**: `Loan application processing promptness` will positively influence the overall attitude toward credit union’s operational efficiency.*

. . .

***H5c**: Member `satisfaction with level of financial services in meeting needs` will positively influence the overall attitude toward credit union’s operational efficiency.*

. . .

***H5d**: `Loan application simplicity and easiness` will positively influence the overall attitude toward credit union’s operational efficiency.*

# `r fontawesome::fa("laptop-code", "white")` Methods {background-color="#447099"}

## Research Design

-   A `mail survey` was used due to the following reasons:
    -   CU membership is widely dispersed geographically
    -   Low cost
    -   Sensitive questions needs anonymity to induce a candid response
    -   Long time needed for mail survey is not an issue for the board.

. . .

-   Questions were mostly `structured` with several key questions asked in `unstructured` format

. . .

-   `Likert-type` scales were used for attitudes measurements.

## Population and Sampling

-   `Population`: All current members of the EFCU.
-   `Sampling frame`:
    -   A list of members and their addresses is available.
    -   3,531 members as of January 31 for trial balance listing of the EFCU membership

. . .

-   `Sampling method`: *Simple random sampling*
    -   `Sample size`: 300
        -   Calculation: was done using estimated`population standard deviation` based on responses of 15 members to Q37.
        -   300 random numbers were generated within the range of 1 to 3,531 members.
        -   Each random number was matched with the corresponding number in the sampling frame.

## Data Collection and coding

::: incremental
-   Preparatoin of all copies of survey and mailing them were handled by the CU's staff members.
-   The structured questions in the survey were coded based on the classifications established by researchers
-   Questionnaire responses were examined for the integrity, and a few responses of low quality were excluded
:::

## Data Preparation

::: {.fragment .fade-up .highlight-red}
-   Used R/RStudio for wrangling and visualization
:::

::: incremental
-   Data `wrangling and preparation` was done separately. Specifically, we did the following
    -   `Reverse coded`
    -   Removed non-responses (`NA`)
    -   Removed `Not Applicable responses` from otherwise Likert-type interval scales to make them suitable for continuous variables (e.g., 1-5 piont scale)
    -   Renamed variable names
    -   Relabeled variable labels and value labels if needed.
    -   The prepared data is saved as `Case 31 Data_efcu_Prepped.sav`, which will be used for data analysis.
:::

```{r}
#| echo: false

### Libraries 
#### Loading common packages
library(tidyverse)
library(haven) 
library(labelled) 
library(janitor) 
library(sjPlot)
library(psych)
library(gt)
library(gtsummary)
set_theme(theme_minimal())
```

```{r}
#| echo: false
#| output: false

### Reading data
case31 <- read_sav("Case 31 Data_efcu_Prepped.sav")
dim(case31)
ncol(case31)
nrow(case31)

```

## Variables in the data

-   Number of variables: `r ncol(case31)`

::: {style="font-size: 14px;"}
```{r}
#| echo: false

# generate data dictionary
case31 |> 
  view_df()
```
:::

## Sample Characteristics

```{r}
#| echo: false
#| output: false

pct_headqrt <- case31 |> 
  count(q38) |> 
  mutate(percent = n/sum(n)) |> 
  filter(q38 == 1) |> 
  select(percent)
```

-   Number of participants: `r nrow(case31)`
-   \% of the participants who live in the `headquarter area` vs. `non-headquarter area`: `r round(pct_headqrt*100, 1)`% vs. `r round((1-pct_headqrt)*100, 1)`%.
-   No demographic variables are available on the survey
    -   Gender
    -   Ethnicity/Race
    -   Income
    -   Education

## Measures

-   Refer to the Construct and Measurement Table.
-   All constructs, operationalization, and scales will be provided later.

# `r fontawesome::fa("laptop-code", "white")` Analysis and Results {background-color="#447099"}

-   Used R for wrangling and modeling

# R1: Overview - One-Sample t-test {background-color="aquamarine"}

**R1: Why do people join the Credit Union?**

-   `Constructs and roles`: reasons for why people join the Credit Union
-   `Operationalization`: q7r (Savings rates)
-   `Scales:`
    -   1-5 point, Likert-type scale
-   `Statistics to be used`:
    -   Descriptive statistics, followed by one sample t-test

## Descriptive Statistics

. . .

### Frequency Distribution

```{r}
#| echo: false
#| label: fig-freq
#| fig-cap: Response Frequency of Savings Rate (q7r)
#| fig-cap-location: top

library(gt)
case31 |> 
  count(q7r) |> 
  mutate(percent = n/sum(n),
         q7r = as_factor(q7r)) |> 
  gt()
```

### Descriptive Stat

```{r}
#| echo: false
#| label: fig-desc-stat-savings
#| fig-cap: Descriptive Statistics for Savings Rate (Q7r)
#| fig-cap-location: margin

describe(case31$q7r) |> 
  gt()
```

------------------------------------------------------------------------

```{r}
#| echo: false
#| label: fig-hist-savings-rate
#| fig-cap: Histogram for Savings Rate (Q7r)

case31 |> 
  filter(!is.na(q7r)) |> 
  mutate(q7r = haven::as_factor(q7r)) |> 
  ggplot(aes(q7r, fill = q7r)) +
  geom_bar(show.legend = FALSE) +
  labs(x = "Savings Rate",
       y = "# of Responses",
       title = "Frequency of Member Opinions on Savings Rates",
       caption = "1 = Very Low ... 5 = Very High")
```

------------------------------------------------------------------------

## One-sample t-test

::: medium-text
-   $H_0: \mu = 3$
-   $H_A: \mu \neq 3$

```{r}
#| output-location: column-fragment

mean_q7r <- case31 |> #count(q7r)
  summarise(mean = mean(q7r, na.rm = TRUE)) |> 
  round(2)

case31 |> 
  t.test(q7r ~ 1, mu = 3, data = _)
```
:::

------------------------------------------------------------------------

::: {.callout-note .large-callout}
## Insights about R1

-   The majority of the survey participants (`65%`) think that the savings rate the CU offers is average.
-   The **`sample mean`** is `r mean_q7r`, which is not statistically different from 3 ("average") (*p* \> .10).
-   Thus, we can conclude that CU members perceive that the savings rate CU applies to them is about average.
:::

# R2: Overview {background-color="aquamarine"}

R2: Why do members use other financial institutions when they need to borrow funds?

-   `Constructs and roles`: Reasons to use loans from other financial institutions
-   `Operationalization`:
    -   q8r (Fund borrowing rates)
    -   q30 (CU rates lower)
-   `Scales:`
    -   1-5 point, Likert-type scales
-   `Statistics to be used`:
    -   Descriptive statistics, followed by one sample t-test

## Descriptive Statistics

## One-sample t-test

# R3: Overview - One-sample t-test {background-color="aquamarine"}

R3: What are the members’ attitudes and beliefs about the proficiency of credit union employees?

-   `Constructs and roles`: Attitudes toward employee proficiency
-   `Operationalization`:
    -   q3, q4, q5, q6 --\> at_emp
-   `Scale: interval scale`: 1-5 point, Likert-type scale
-   `Statistics`:
    -   Descriptive statistics
    -   Reliabilty/factor analysis,
    -   one-sample t-test

## Descriptive Statistics

### Means & SD

::: medium-text
```{r}
#| output-location: fragment
describe(case31$at_emp)
```
:::

------------------------------------------------------------------------

### Histogram

```{r}
#| label: fig-at_emp-histogram
#| echo: false
#| fig-cap: Histogram of Employee Proficiencies (at_emp) with a Mean line

case31 |> 
  ggplot(aes(at_emp)) +
  geom_histogram(binwidth = 0.5, color = "black", fill = "lightblue") +
  geom_vline(aes(xintercept = mean(at_emp, na.rm = TRUE)),
             color = "red", linetype = "dashed", size = 1) +
  geom_text(aes(x = mean(at_emp, na.rm = TRUE), 
                y = 30, 
                label = paste0("Mean = ", round(mean(at_emp), 2))),
            color = "red", angle = 90, vjust = -0.5, hjust = 2.2) +
  labs(title = "Histogram of Employee Proficiencies with a Mean line",
       x = "Employee Prociency",
       y = "Count") +
  scale_x_continuous(limits = c(1, NA))
  
```

## Reliability/factor analysis

-   We already looked at reliability and unidimensionality in the data preparatoin stage.
-   The four items are highly representative of the latent construct.
-   Therefore, we created a `composite index` and use it

## One-sample t-test

::: medium-text
-   $H_0: \mu = 4$
-   $H_A: \mu \neq 4$

```{r}
#| output-location: fragment
case31 |> 
  t.test(at_emp ~ 1, mu = 4, data = _)
```
:::

------------------------------------------------------------------------

::: {.callout-note .large-callout}
## Summary insights about R3

Participants perceived Employee proficiency (*M* = `4.21` out of 5.0) is statistically significantly greater than 4.0 (`"Agree"`) (*p* \< .001)
:::

# R4 Overview {background-color="aquamarine"}

R4: Are there any perceived differences on (a) attitude towards employee proficiency, (b) awareness of services, and (c) operational effectiveness between members who live in the area of the firm’s headquarters and members who live elsewhere?

-   R4a: Two Samples t-Test
-   R4b: Two-way cross-tabs, followed by Chi-square independence test
-   R4c: Two tests possible depending on variables to use.
    -   2-groups t-test
    -   Ch-square independence test

## R4a Analysis Overview (Two samples t-test)

R4a: Are there any perceived differences on attitude towards employee proficiency between members who live in the area of the firm’s headquarters and members who live elsewhere?

::: small-text
-   `Constructs and roles`:
    -   Member residence: IV
    -   Attitudes toward employee proficiency: DV
:::

. . .

::: small-text
-   `Operationalization`:
    -   q38
    -   at_emp
-   `Scale`:
    -   Nominal scale:
    -   interval scale: 1-5 point, Likert-type scale
:::

. . .

::: small-text
-   `Statistics`:
    -   Descriptive statistics, followed by **`independent samples t-test`**
:::

------------------------------------------------------------------------

### Descriptives

#### Boxplot

```{r}
#| echo: false
#| label: fig-box-at-emp-by-residence
#| fig-cap: Attitudes toward employee proficiency by residence
case31 |> 
  mutate(q38 = haven::as_factor(q38)) |> 
  ggplot(aes(q38, at_emp, fill = q38)) +
  geom_boxplot() +
  labs(x = "Live in HQ Area",
       y = "Attitudes toward Employee Proficiency",
       title = "Does Employee Proficiency differ by where customers live?") +
  theme(legend.position = "none")

```

------------------------------------------------------------------------

#### Barplot

```{r}
#| echo: false
#| label: fig-bar-at-emp-by-residence
#| fig-cap: Attitudes toward employee proficiency by residence
case31 |> 
  mutate(q38 = haven::as_factor(q38)) |> 
  group_by(q38) |> 
  summarize(mean = mean(at_emp, na.rm = TRUE)) |> 
  ggplot(aes(q38, mean, fill = q38)) +
  geom_col() +
  labs(x = "Live in HQ Area",
       y = "Attitudes toward Employee Proficiency",
       title = "Does Employee Proficiency differ by where customers live?") +
  theme(legend.position = "none")
```

------------------------------------------------------------------------

### Two independent samples t-test

:::::: panel-tabset
#### Levene's Test

::: medium-text
```{r}
#| echo: true
#| output-location: default

library(car)

case31 |> 
  mutate(q38 = haven::as_factor(q38)) |> 
  leveneTest(at_emp ~ q38, data = _)
```
:::

#### Variance test

::: medium-text
```{r}
case31 |> 
  mutate(q38 = haven::as_factor(q38)) |> 
  var.test(at_emp ~ q38, data = _)
```
:::

#### Two Samples t-test

::: medium-text
```{r}
# t.test: assuming var are equal
case31 |> 
  t.test(at_emp ~ q38, data = _, var.equal = TRUE) 
```
:::
::::::

------------------------------------------------------------------------

#### Summary Table

```{r}
#| echo: true
#| output-location: column-fragment
#| label: tbl-att_emp_by_HQ
#| tbl-cap: Do Customers Differ in their Attitudes toward Employee Proficiency depending on where they live?

case31 |> 
  mutate(q38 = haven::as_factor(q38)) |> 
  tbl_summary(
    include = c(q38, at_emp),
    by = q38,
    type = at_emp ~ "continuous2",
    statistic = list(all_continuous() ~ c("{mean} ({sd})",
                                          "{min}, {max}"))
  ) |> 
  add_difference() |> 
  add_overall() |> 
  add_n() |> 
  modify_caption("**Test of Differences in Attitudes toward Employee Proficiency between customers who live in Headquarter area and those who live in non-headquarter area**") |> 
  modify_spanning_header(
    c(stat_1, stat_2) ~ "**Live in Headquarter Area?**") 
```

------------------------------------------------------------------------

::: {.callout-tip .large-callout}
### Summary insights about H4a

-   The group mean value of employee proficiency for `customers who live in HQ` (*M* = 4.28) and `those who live elsewhere` (*M* = 4.14) are not statistically different (*p* \> 0.10).

-   Thus, we conclude that CU member perception of CU employee proficiency does not differ regardless of whether they live in headquarters area or not.
:::

## R4b Analysis Overview ($\chi^2$ Independence Test)

R4b: Are there any perceived differences on awareness of services between members who live in the area of the firm’s headquarters and members who live elsewhere?

::: small-text
-   `Constructs and roles`:
    -   Member residence: IV
    -   service awareness: DV
:::

. . .

::: small-text
-   `Operationalization`:
    -   q38
    -   q13r - q26r
-   `Scale`:
    -   Nominal scale
    -   Ordinal scale
:::

. . .

::: small-text
-   `Statistics`:
    -   Two-way cross-tabs, followed by Chi-square independence test
:::

------------------------------------------------------------------------

### q13r (Share account) by q38

::::::: panel-tabset
#### Cleaning

::: medium-text
```{r}
case31 <- case31 |> 
  mutate(q13r = haven::as_factor(q13r),
         q38 = haven::as_factor(q38))
```
:::

#### cross-tab

::: medium-text
```{r}
table(case31$q13r, case31$q38)

# cross-tab: %
table(case31$q13r, case31$q38) |> 
  prop.table(margin = 2) * 100 
```
:::

#### Mosaic Plot

::: medium-text
```{r}
#| echo: false
#| label: fig-q13r-q38-mosaic
#| fig-cap: Association of the awareness of regular share account by residence

table(case31$q38, case31$q13r) |> 
  mosaicplot(main = "Awareness of Regular share account by Residence", 
             color = TRUE, las = 1 )
```
:::

#### Chi-square test of independence

-   $H_0$: Awareness of regular share account is `independent` of members' residence
-   $H_A$: Awareness of regular share account is `dependent` on members' residence

::: medium-text
```{r}
table(case31$q13r, case31$q38) |>
  chisq.test() 
```
:::
:::::::

::: aside
**Note**: The various steps in in slide can be more effectively followed in a regular report. In a presentation like this, a simpler but more visually effective summary table, like the publication-ready table, using `gt-summary` package. Refer to @tbl-christmas_by_HQ.
:::

------------------------------------------------------------------------

::: {.callout-tip .large-callout}
#### Insights

-   Members' awareness of regular share account is not associated with the place of members' residence.
-   Paraphrasing, members' awareness of regular share account is independent of where they live.
:::

------------------------------------------------------------------------

### q14r (Special subaccounts) by q38

::::::: panel-tabset
#### Cleaning

::: medium-text
```{r}
case31 <- case31 |> 
  mutate(q14r = haven::as_factor(q14r))
```
:::

#### Cross-tab

::: medium-text
```{r}
# cross-tabulation: count

table(case31$q14r, case31$q38)

# cross-tab: %
table(case31$q14r, case31$q38) |> 
  prop.table(margin = 2) * 100 
```
:::

#### Mosaic Plot

::: medium-text
```{r}
#| echo: false
table(case31$q38, case31$q14r) |> 
  mosaicplot(main = "Awareness of Special Sub accounts by Residence", 
             color = TRUE, las = 1 )
```
:::

#### Chi-square test of independence

::: medium-text
```{r}
table(case31$q14r, case31$q38) |>
  chisq.test() 
```
:::
:::::::

------------------------------------------------------------------------

### q15r by q38 with gt_summary table
- q15r (Christmas club account)
```{r}
#| output-location: column
#| label: tbl-christmas_by_HQ
#| tbl-cap: Christmas Club Account Awareness by Location of Residence

case31 <- case31 |> 
  mutate(q15r = haven::as_factor(q15r))

case31 |> 
  tbl_summary(
    include = c(q15r, q38),
    by = q38
  ) |> 
  add_p() |> 
  modify_spanning_header(all_stat_cols() ~ "**Live in HQ Area?**") |> 
  add_n() |> 
  italicize_labels() |> 
  #show_header_names()
  modify_header(label ~ "**Awareness**") |> 
  as_gt() |> 
  tab_header(
    title = md("**Chi-Square Test of Independece**"),
    subtitle = md("*Christmas Club Account Awareness by Where Customers Live*")
  )
```
::: {.notes}
The gt_summary package works with gt package using `as_gt()`
:::

------------------------------------------------------------------------

### Further cleaning

```{r}
case31_clean <- case31 |> 
  mutate(q13r = haven::as_factor(q13r),
         q14r = haven::as_factor(q14r),
         q15r = haven::as_factor(q15r),
         q16r = haven::as_factor(q16r),
         q17r = haven::as_factor(q17r),
         q18r = haven::as_factor(q18r),
         q19r = haven::as_factor(q19r),
         q20r = haven::as_factor(q20r),
         q21r = haven::as_factor(q21r),
         q22r = haven::as_factor(q22r),
         q23r = haven::as_factor(q23r),
         q24r = haven::as_factor(q24r),
         q25r = haven::as_factor(q25r),
         q26r = haven::as_factor(q26r)
         )
```

------------------------------------------------------------------------

### Creating a function for chi-square independence test

```{r}

chisq_ind_test <- function(data, var) {
  
  library(dplyr)
  library(rlang)
  library(glue)
  
  var <- enquo(var)  # Capture the column as a quosure
  
  # Remove NA's
  data <- data |> 
    filter(!is.na(!!var), !is.na(q38))
  
  # Remove unused levels to avoid errors in chi-square test
  data <- data |> 
  mutate(!!var := droplevels(!!var)) # dynamic column name
  
  # Cross-tab
  tab <- table(pull(data, !!var), data$q38)

  # Cross-tab: %
  prop_tab <- prop.table(tab, margin = 2) * 100

  # Mosaic Plot
  tab_c <- table(data$q38, pull(data, !!var))
  
  mosaicplot(
    tab_c,
    main = glue::glue("Awareness of {quo_name(var)} by Residence"),
    color = TRUE, las = 1
  )

  # Chi-square test of independence
  chi_sq_result <- chisq.test(tab)

  # Return results as a list
  list(
    crosstab = tab,
    proportions = prop_tab,
    chi_square = chi_sq_result
  )
}

```

------------------------------------------------------------------------

### Testing all

```{r}
#| output-location: slide
awareness <- vars(q13r, q14r, q15r, q16r, q17r, q18r, q19r, q20r, q21r, q22r, q23r, q24r, q25r, q26r) # Quote the variables

awareness |> 
  map(~ chisq_ind_test(case31_clean, !!.x))
```

#### testing for q26r by q38

```{r}
case31_clean |> 
  chisq_ind_test(q26r)
```

## R4c Analysis Overview

-   R4c: Are there any perceived differences on operational effectiveness between members who live in the area of the firm’s headquarters and members who live elsewhere?

:::::: small-text
::::: columns
::: {.column .fragment width="50%"}
-   `Constructs and roles`:
    -   Member residence: IV
    -   operatoinal effectiveness: DV
-   `Operationalization`:
    -   q38
    -   q9r, q10r,
    -   q11-q12r,
    -   q31-q34,
    -   q37r
:::

::: {.column .fragment width="50%"}
-   `Scale`:
    -   Nominal scale
    -   interval scales
    -   Nominal
    -   interval
    -   interval
-   `Statistics`:
    -   Descriptive statistics, followed by
        -   2-groups t-test
        -   Ch-square independence test
        -   2-groups t-test
        -   2-groups t-test
:::
:::::
::::::

# R5 ($\chi^2$ Goodness of Fit) {background-color="aquamarine"}

R5: How well are the members aware of the services offered by the credit union?

-   `Constructs and roles`:
    -   Awareness of services:
-   `Operationalization`:
    -   q13r-q26r
-   `Scale`:
    -   Ordinal scale:
-   `Statistics`:
    -   Chi-square goodness-of-fit test

## q13r

------------------------------------------------------------------------

### Summary table

::: medium-text
```{r}
#| output-location: column
#| label: tbl-q13r
#| tbl-cap: Regular Share Account Awareness Frequency

case31_clean |> 
  tbl_summary(
    include = q13r,
    type = all_categorical() ~ "categorical"
  ) |> 
  italicize_labels() |> 
  #show_header_names()
  modify_header(label ~ "**Awareness**") |> 
  modify_caption("**Chi-Square Goodness of Fit Test**:<br>*Regular Share Account Awareness*")
```
:::

::: notes
Unfortunately, chi-square-goodness-of-fit statistics cannot be calculated directly in gt_summary
:::

------------------------------------------------------------------------

### Barplot

```{r}
#| output-location: column-fragment
case31_clean |>
  ggplot(aes(q13r, fill = q13r)) +
  geom_bar() +
  theme(legend.position = "none")
```

------------------------------------------------------------------------

### Chi-square Goodness-of-fit test

-   $H_0$ = the observed data follows the expected distribution
-   $H_A$ = the observed data follows the expected distribution

::: medium-text
```{r}
#| output-location: fragment

expected = c(1/3, 1/3, 1/3)
table(case31_clean$q13r) |> 
  chisq.test(p = expected)
```
:::

------------------------------------------------------------------------

::: {.callout-important .large-callout}
### Insights

-   There is statistically significant evidence that the observed data doesn't follow from the theoretical distribution
-   the level of members' awareness of regular share account is different across the three levels with "unawareness being highest
:::

## More efficient testing with a function

```{r}
#| output-location: fragment
# data

awareness_long <- case31_clean |> 
  select(q13r:q26r) |> 
  pivot_longer(cols = everything(),
               names_to = "services",
               values_to = "aware_level")
awareness_long

```

------------------------------------------------------------------------

```{r}
#| output-location: fragment
# Expected proportions (e.g., equal distribution across levels)
exp_p <- c(`Unaware` = 1/3, 
           `Aware but Have Not Used` = 1/3, 
           `Aware and Have Used` = 1/3) 

# Perform chi-square goodness of fit for each product
awareness_long |> 
  group_by(services) |> 
  count(aware_level) |> 
  complete(aware_level = names(exp_p), fill = list(n = 0)) |> # tidyr
  group_by(services) |> 
  summarise(
    chisq_test = list(chisq.test(
      x = n,
      p = exp_p[levels(factor(aware_level))]
  ))
  ) |> 
  mutate(tidy_results = map(chisq_test, broom::tidy)) |> 
  unnest(tidy_results)
```

------------------------------------------------------------------------

::: {.callout-note .large-callout}
### Insights about R5

-   Series of Chi-square goodness-of-fit statistics show and for all services, frequency distributions of awareness levels are significantly different from each other and the pattern of differences are quite similar with unawareness being largest across all types of financial services.

-   The company should increase the awareness.
:::

# R6 Overview ($\chi^2$ & t-test) {background-color="aquamarine"}

R6: What are the members’ attitudes and beliefs about how effectively the credit union is operated?

::::: {.columns .small-text}
::: {.column .fragment .highlight-blue width="50%"}
-   `Constructs and roles`:
    -   Attitude toward operational effectiveness
-   `Operationalization`:
    -   Q9r–Q10r
    -   Q11–Q12rc,
    -   Q31 – Q34
    -   Q37r
-   `Scale`:
    -   ordinal/internal scale
    -   nominal scale
    -   Interval
    -   Interval
:::

::: {.column .fragment .highlight-blue width="50%"}
-   `Statistics`:
    -   DS / Chi-square goodness-of-fit test
    -   DS / Chi-square goodness-of-fit test
    -   DS / One group t-test
    -   DS / One group t-test
:::
:::::

# H1 Overview - One-way ANOVA {background-color="steelblue"}

H1: Members’ awareness of the regular share accounts will influence their opinions on the adequacy of financial services in meeting members’ needs.

::: small-text
-   `Constructs and roles`:
    -   Members’ awareness of the regular share account (IV)
    -   Adequacy of financial services in meeting member needs (DV)
:::

. . .

::: small-text
-   `Operationalization`:
    -   q13r
    -   q33
-   `Scale`:
    -   Ordinal scale
    -   Interval
:::

. . .

::: small-text
-   `Statistics`:
    -   DS / One-way ANOVA
:::

## Visualization

------------------------------------------------------------------------

### Frequency by groups

```{r}
#| echo: false
#| label: fig-q33-q13r-histogram
#| fig-cap: Frequency Distribution of Adequacy of Financial Services in Meeting Members' Needs (q33) by Their Awareness of Regular Share Accounts (q13r)

case31_clean |> 
  group_by(q13r) |> 
  ggplot(aes(q33, fill = q13r)) +
  geom_histogram(binwidth = 0.5) +
  facet_wrap(~q13r) +
  theme(legend.position = "none")
```

------------------------------------------------------------------------

### Mean value by groups

```{r}
#| echo: false
#| label: fig-q33-q13r-barplot
#| fig-cap: Mean VAlue of Adequacy of Financial Services in Meeting Members' Needs (q33) by Their Awareness of Regular Share Accounts (q13r)

case31_clean |> 
  group_by(q13r) |> 
  summarize(mean = mean(q33)) |> 
  ggplot(aes(mean, q13r, fill = q13r)) +
  geom_col() +
  geom_text(aes(label = glue::glue("{round(mean, 2)}")),
            hjust = -0.1) +
  theme(legend.position = "none") +
  labs(x = "Average Value of Adequacy of Financial Services in Meeting Members' Needs",
       y = "Level of Awareness of Regular Share Account",
       title = "Impact of Awareness of Services on Perceived Adequcey of Financial Services")
```

## ANOVA Test Procedure

------------------------------------------------------------------------

### 1. Check normality assumption

-   The dependent variable should be approximately normally distributed within each group.
-   $H_0:$ The data are normally distributed
-   $H_1:$ The data are NOT normally distributed

:::::: columns
::: {.column .fragment}
#### Overall test for q33

```{r}
# Shapiro-Wilk normality test 

case31_clean |> 
  pull(q33) |> 
  shapiro.test()
```
:::

::: {.column .fragment}
#### Test by awareness group on q33

```{r}
case31_clean |> 
  group_by(q13r) |> 
  summarise(p_value = shapiro.test(pull(cur_data(), q33))$p.value)
```
:::

::: {.column .fragment}
#### Test of Normality on Residuals

```{r}
h1_aov_model <- case31_clean |> 
  aov(q33 ~ q13r, data = _) 

residuals(h1_aov_model) |> 
  shapiro.test()
```
:::
::::::

::: notes
-   ANOVA's normality assumption applies to the residuals, not the raw dependent variable.
-   Residuals represent the unexplained variation after accounting for group means, which is what needs to be approximately normally distributed for valid ANOVA results.
-   The dependent variable might not follow a normal distribution, but if the residuals do, the ANOVA results are still valid.
:::

------------------------------------------------------------------------

### 2. Homogeneity of variance

-   $H_0:$ Variance is the same across the groups
-   $H_1:$ The data is NOT normally distributed

```{r}
library(car)
case31_clean |> 
  leveneTest(q33 ~ q15r, data = _)
```

------------------------------------------------------------------------

### 3. ANOVA Test

-   $H_0:$ All group means are equal ($\mu_1 = \mu_2 = \mu_3 = ... = \mu_k$)
-   $H_1:$ At least one pair of group means is different

::::: columns
::: {.column .fragment}
#### Under homoskedasticity

```{r}
case31_clean |> 
  aov(q33 ~ q13r, data = _) |> 
  summary()
```
:::

::: {.column .fragment}
#### Since residuals are non-normal

-   Kruskal-Wallis Test
    -   non-parametric
    -   compares the medians of three or more independent groups to determine if they differ significantly.

```{r}
case31_clean |> 
  kruskal.test(q33 ~ q13r, data = _)
```
:::
:::::

::: notes
-   If variances are not the same across groups, use Welch's ANOVA or Kruskal-Wallis test

```         
oneway.test(dependent_variable ~ group, data = your_data, var.equal = FALSE)
```
:::

------------------------------------------------------------------------

### 4. Summary Table

:::: medium-text
```{r}
#| echo: true
#| output-location: column-fragment
#| label: tbl-adequcy_of_finanical_services_by_q13r
#| tbl-cap: Does Awareness of Regular Share Account Affects Members' Perceived Adequacy of Financial Services in Meeting their Needs?

anova_model <- case31_clean |> 
  aov(q33 ~ q13r, data = _) 

anova_summary <- summary(anova_model)

anova_pvalue <- anova_summary[[1]][["Pr(>F)"]][1]

case31_clean |> 
  mutate(q33 = as.numeric(q33)) |> 
  tbl_summary(
    include = c(q13r, q33),
    by = q13r,
    type = q33 ~ "continuous2",
    statistic = list(all_continuous() ~ c("{mean} ({sd})",
                                          "{min}, {max}")),
    label = q33 ~ "Adequacy of Financial Services"
  ) |> 
  modify_spanning_header(
    all_stat_cols() ~ "**Regular Share Account Awareness Levels**") |> 
  add_overall() |> 
  modify_caption("**Test of Differences in Perceived Adequacy of Financial Services in Meeting Memberss Needs:**<br>_Diffential Effect by Awareness of Regular Share Account (q13r)_") |> 
  italicize_labels() |> 
  modify_footnote(
    c(stat_1, stat_2, stat_3) ~ glue::glue("One-way ANOVA with equal variance assummed p-value: {format.pval(anova_pvalue, digits = 3)}")) |> 
  #show_header_names()
  modify_header(label ~ "**Variable**")
```

::: {.aside}
**Note**: ANOVA with more than 2 levels cannot be computed in `gt_summary()`[@sjoberg2021]. Thus, p-value should be obtained separately from aov and added to the table as a footnote.
:::
::::

---

### 5. Post-hoc Analysis if not all group means are the same

::::: {columns}
::: {.column .fragment}
#### When ANOVA is significant

```{r}
case31_clean |> 
  aov(q33 ~ q13r, data = _) |> 
  TukeyHSD()
```
:::

::: {.column .fragment}
#### When Kruskal-Wallis is significant

```{r}
library(dunn.test)

# Post-hoc pairwise comparisons
dunn.test(as.numeric(case31_clean$q33), case31_clean$q13r, method = "bonferroni")
```
:::
:::::

------------------------------------------------------------------------



------------------------------------------------------------------------

::: {.callout-note .incremental .large-callout}
### Insights about H1

-   Normality assumption of residuals from ANOVA was not met
-   However, homoskedasticity assumption is hold true
-   Both ANOVA and Kruskal-Wallis test is significant; Thus, post-hoc analysis is conducted.
-   Post-hoc analysis results are the same regardless of the methods.
-   Members' perception of adequacy of financial services is most negative among who have highest level of awareness of regualr savings account (`aware and have used it`), while it is not different between the two lower awareness groups (`aware but have not used it` vs. `unaware`)
:::

# H2: Overview - Paired Samples t-Test {background-color="black"}

H2: Members will not be different in their opinion on CU’s loan rate (Q8r) and the degree to which they agree that CU’s loan rate is lower than competitors (Q30).

# H3a: Overview - Two-way ANOVA {background-color="black"}

H3a: There will be interaction effect between the current loan use and location of residence on adequacy of current financial services such that in headquarter area, members who have a loan will agree, more than those who don’t have, that financial services meet the members’ needs, while in outside headquarter area, loan status doesn’t influence adequacy of financial services in meeting member needs.

# H3b: Overview - Two-way ANCOVA {background-color="black"}

H3b: Test H2a controlling for the impact of attitudes toward employee proficiency.

# H4: Overview - MANOVA {background-color="black"}

H4: Compared with the members who have a loan, [those members who don’t have a loan]{style="color:red;"} currently with the Credit Union will feel that that CU charges them with higher rates, and that they will agree less with the statement that CU’s loan rates are lower than those offered by other institutions.

# H5: Overview - Multiple Regression {background-color="steelblue"}

::::::: small-text
::: {.fragment .fade-in-then-semi-out}
H5a: Member belief about CU keeps personal `financial information confidential` will positively influence the [overall attitude toward credit union’s operational efficiency]{style="color:orange;"}.
:::

::: {.fragment .fade-in-then-semi-out}
H5b: `Loan application processing promptness` will positively influence the overall attitude toward credit union’s operational efficiency.
:::

::: {.fragment .fade-in-then-semi-out}
H5c: `Member satisfaction with level of financial services in meeting needs` will positively influence the overall attitude toward credit union’s operational efficiency.
:::

::: {.fragment .fade-in-then-semi-out}
H5d: `Loan application simplicity and easiness` will positively influence the overall attitude toward credit union’s operational efficiency.
:::
:::::::

. . .

:::::: small-text
::::: columns
::: {.column .fragment width="60%"}
-   `Constructs and roles`:
    1.  Overall managerial and operational efficiency (DV)
    2.  Confidentiality of personal financial information (IV)
    3.  Loan application processing promptness (IV)
    4.  Adequacy of financial services in meeting needs (IV)
    5.  Simplicity and easiness of loan application (IV)
:::

::: {.column .fragment width="40%"}
-   `Operationalization`:
    1.  q37r
    2.  q31
    3.  q32
    4.  q33
    5.  q34
-   `Scale`:
    -   all of them are interval
-   `Statistics`:
    -   separate visualization, followed by `multiple regression`
:::
:::::
::::::

## Checking Assumptions of Multiple Regression

------------------------------------------------------------------------

### 1. Linearity Check

::: panel-tabset
#### q31 vs. q37r

```{r}
#| output-location: column
# Scatterplot for each predictor against the outcome
ggplot(case31_clean, aes(x = q31, y = q37r)) + 
  geom_point() + 
  geom_smooth(col = "blue") +
  labs(title = "Linearity Check: q31 vs q37r")
```

#### q32 vs. q37r

```{r}
#| output-location: column
# Scatterplot for each predictor against the outcome
ggplot(case31_clean, aes(x = q32, y = q37r)) + 
  geom_point() + 
  geom_smooth(col = "blue") +
  labs(title = "Linearity Check: q32 vs q37r")
```

#### q33 vs. q37r

```{r}
#| output-location: column

# Scatterplot for each predictor against the outcome
ggplot(case31_clean, aes(x = q33, y = q37r)) + 
  geom_point() + 
  geom_smooth(col = "blue") +
  labs(title = "Linearity Check: q33 vs q37r")

```

#### q34 vs. q37r

```{r}
#| output-location: column

# Scatterplot for each predictor against the outcome
ggplot(case31_clean, aes(x = q34, y = q37r)) + 
  geom_point() + 
  geom_smooth(col = "blue") +
  labs(title = "Linearity Check: q34 vs q37r")
```

#### Partial residual plots

-   visualize the relationship between a predictor and the response variable, accounting for the effects of other predictors in the model.
-   If the relationship between the predictor and the response is linear, the points in the plot should roughly follow a straight line.

```{r}
#| output-location: column

library(car)
lm_model <- case31_clean |> 
  filter(!is.na(q37r)) |> 
  lm(q37r ~ q31 + q32 + q33 + q34, data = _)
crPlots(lm_model)

```
:::

::: notes
-   If the points show a curved or non-linear pattern, this indicates that a linear model may not be appropriate, and the predictor might require a transformation (e.g., log, quadratic).
:::

------------------------------------------------------------------------

### 2. Independence Check

-   $H_0:$ There is no first-order autocorrelation in the residuals (errors are independent).
-   $H_1:$ There is evidence of positive or negative autocorrelation.
-   Test statistics (d)
    -   $d \approx 2$: No autocorrelation
    -   $d < 2$: Positive autocorrelation
    -   $d > 2$: Negative autocorrelation

```{r}
#| output-location: column

library(lmtest)
dwtest(lm_model)  # Durbin-Watson test for autocorrelation

```

------------------------------------------------------------------------

### 3. Homoscedasticity Check

::: panel-tabset
#### Residuals vs. Fitted Plot

```{r}
#| output-location: column

plot(lm_model, which = 1)  # Built-in residuals vs. fitted plot
```

#### bp test

-   $H_0:$ The errors have constant variance (homoscedasticity).
-   $H_1:$ The errors exhibit heteroscedasticity (i.e., non-constant variance).

```{r}
#| output-location: column

library(lmtest)
bptest(lm_model)  # Breusch-Pagan test for heteroscedasticity

```
:::

------------------------------------------------------------------------

### 4. Normality of Residuals

::: panel-tabset
#### Histogram of residuals

```{r}
#| output-location: column

residuals <- residuals(lm_model)
hist(residuals, breaks = 20, main = "Histogram of Residuals")

```

#### Q-Q Plot

```{r}
#| output-location: column

qqnorm(residuals)
qqline(residuals, col = "blue")

```

#### Test of normality

-   $H_0:$ The data is normally distributed
-   $H_1:$ The data is not normally distributed.

```{r}
#| output-location: column

shapiro.test(residuals)  # Shapiro-Wilk test

```
:::

------------------------------------------------------------------------

### 5. Multicollinearity Check

-   VIF \> 5: Possible multicollinearity.
-   VIF \> 10: Strong multicollinearity, consider dropping or combining predictors.

```{r}
library(car)
vif(lm_model)  # VIF values

```

------------------------------------------------------------------------

### 6. Outliers and Influential Observations

::: panel-tabset
#### Cook's Distance

```{r}
#| output-location: column

plot(lm_model, which = 4)  # Built-in Cook's distance plot

```

#### Leverage and DFBETAS

```{r}
#| output-location: column

# Leverage Plot
hatvalues <- hatvalues(lm_model)
plot(hatvalues, main = "Leverage Values", ylab = "Leverage")

# DFBETAS
dfbetas <- dfbeta(lm_model)
head(dfbetas)  # Shows influence of each observation

```
:::

------------------------------------------------------------------------

### 7. Cross-validation

::::: columns
::: {.column width="50%"}
#### Define control for cross-validation

```{r}
library(caret)
set.seed(123)

train_control <- trainControl(method = "cv", number = 10)

case31_clean <- case31_clean |> 
  filter(!is.na(q37r)) |> 
  mutate(q37r = as.numeric(q37r))

```
:::

::: {.column width="50%"}
#### Train the model

```{r}
cv_model <- train(
  q37r ~ q31 + q32 + q33 + q34,
  data = case31_clean,
  method = "lm",
  trControl = train_control)

cv_model  # Check cross-validation results
cv_model$resample
```
:::
:::::

------------------------------------------------------------------------

### Model Parameters

::: {.panel-tabset}

#### Final Model Parameters from CV

```{r}
#| output-location: column

summary(cv_model) # summary function returns final model fit based on entire data
```

---

#### Multiple Regression & Results

```{r}
#| eval: true
#| output-location: column

case31_clean |> 
  lm(q37r ~ q31 + q32 + q33 + q34, data = _)  |> 
  summary()
```

:::

---

### Summary Table

:::::: {.columns}

::: {.column}
```{r}
#| label: tbl-h5-reg-4vars
#| tbl-cap: Regression Analysis
#| output-location: fragment
#| echo: false
m_h5 <- case31_clean |> 
  lm(q37r ~ q31 + q32 + q33 + q34, data = _) 

#summary(m_h5)$coefficients

m_h5 |> 
  tbl_regression() |>
  add_vif() |> 
  add_q() |> 
  italicize_labels() |> 
  modify_header(label ~ "**Variables**") |> 
  as_gt() |> 
  tab_header(title = md("**Factors that Affect Overall Efficiency**"))
  
```
:::

::: {.column .fragment}
```{r}
#| label: tbl-h5-reg-5vars
#| tbl-cap: Regression Analysis with Customer Locatoin Controlled
#| output-location: fragment
#| echo: false
m_h5_2 <- case31_clean |> 
  lm(q37r ~ q38 + q31 + q32 + q33 + q34, data = _) 

#summary(m_h5_2)

m_h5_2 |> 
  tbl_regression() |>
  add_vif() |> 
  add_q() |> 
  italicize_labels() |> 
  modify_header(label ~ "**Variables**") |> 
  as_gt() |> 
  tab_header(title = md("**Factors that Affect Overall Efficiency**"),
             subtitle = "Controlling for the location of residency"
             )
```
:::

::::::

------------------------------------------------------------------------

:::::: {.callout-note .large-callout}
## Insights about H5

::: {.fragment .shrink .highlight-blue}
-   Overall, the assumptions of multiple regression are supported.
    -   Linearity assumption is okay in general.
    -   Homosckedasticiy assumption is confirmed
    -   Multicollinearity is not an issue.
    -   Normality assumption is not supported.
:::

::: {.fragment .shrink .highlight-green}
-   As expected, `confidentiality` (*p* \< .05), `loan application process` (*p* \< .001) and `adequacy of financial resources` (*p* \< .001) are positively related to the overall efficiency.
:::

::: {.fragment .shrink .highlight-red}
-   `Simplicity and easiness of loan application` is not significantly related to the overall efficiency (*p* \> .10)
:::
::::::

## References

- <https://www.danieldsjoberg.com/gtsummary/>
